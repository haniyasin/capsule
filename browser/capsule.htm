<html>
  <head>
    <title>Browser Capsule Prototype</title>
    <script type="text/javascript" src="module_loader.js"></script>
    <script type="text/javascript" src="dependencies/uuid.js"></script>
    <script type="text/javascript">
      function start(){
      var timer, timer_tester;
      var direct, direct_tester;
      var loader = new module_loader();

      var req = new XMLHttpRequest();
      req.onload = function(){
	  loader.source_add('modules/timer.js', this.responseText);
          timer = { 'js' : loader.load('modules/timer.js') };
      };

      req.open('get','modules/timer.js', true);
      req.send();

      var reqmu = new XMLHttpRequest();
      reqmu.onload = function(){
          loader.source_add('modules/uuid.js', this.responseText);
          tuuid = { 'browser' : loader.load('modules/uuid.js') };
          var uuid_s = tuuid.browser.generate_str();
          var uuid_n = tuuid.browser.parse(uuid_s);
          console.log(uuid_s, uuid_n, tuuid.browser.unparse(uuid_n));
      };

      reqmu.open('get','modules/uuid.js', true);
      reqmu.send();

      var tt_req = new XMLHttpRequest();
      tt_req.onload = function(){
          loader.source_add('tests/timer.js', this.responseText);
          timer_tester = loader.load('tests/timer.js');
          timer_tester.test(timer);
      };

      tt_req.open('get', 'tests/timer.js', true);
      tt_req.send();

      var treq = new XMLHttpRequest();
      treq.onload = function(){
	  loader.source_add('modules/transport.js', this.responseText);

          var tdreq = new XMLHttpRequest();
          tdreq.onload = function(){
	      loader.source_add('modules/transport/direct.js', this.responseText);

              var dtreq = new XMLHttpRequest();
              dtreq.onload = function(){
	          loader.source_add('tests/transport_direct.js', this.responseText);
	          var transport = loader.load('modules/transport.js');
                  transport.direct = loader.load('modules/transport/direct.js');
                  var tdt = loader.load('tests/transport_direct.js');
//                  tdt.test(transport);
              };

              dtreq.open('get','tests/transport_direct.js', true);
              dtreq.send();

          };

          tdreq.open('get','modules/transport/direct.js', true);
          tdreq.send();
  
    };

        treq.open('get','modules/transport.js', true);
        treq.send();

     }

    </script>
  </head>
  <body onload="start()">
    ggg
  </body>
</html>
