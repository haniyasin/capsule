<html>
  <head>
    <script src="bb_allocator.js"/>
    <script id="script_layer">
      // транспорт должен иметь конструктор, который записывает в тег скрипт, в id = common, следующее:

      // возможно нужно рандомизировать имя этого массива и обращение к нему, а также к другим постоянным
      // данным транспорта, чтобы два и более экземпляра транспорта не конфликтовали(но зачем?:D)
      var rca = []; //reply callback array, краткость для экономии траффика:D
      var ids = new bb_allocator(id_manager);

      // это заканчивается
      


      function request_cli_ctx_jsonp_request(address){
          this.address = address;
          this.request = function(data, callback){
              var req_id = ids.alloc();

              var head = document.getElementsByTagName('head')[0];
              var script_tag = document.createElement('script');
              script_tag.setAttribute('id','s' + req_id);
    //  console.log(address + '/?jsonp=_hreq.cb' + req_id);
              //упаковка данных у разных транспортов разная(get, post), и должны быть проверки
              script_tag.setAttribute('src',address + '/' + data + '?jsonp=rca[' + req_id + ']');
              rca[req_id] = function(reply){
                  head.removeChild(script_tag);
                  ids.free(req_id);
                  rca[req_id] = undefined;
                  callback(reply);
              }
              head.appendChild(script_tag);
          }
      }

      r = new request_cli_ctx_jsonp_request('http://localhost:8081');


      r.request('tt', function(data){
             alert(JSON.stringify(data));
      });

      for(var nn = 0; nn != 2; nn++){
      r.request('tt', function(data){
//      alert(data.msg);
      });
      r.request('tt', function(data){
//      alert(data.msg + "hoi");
      r.request('mm', function(data){
//      alert("hoi" + data.msg);
      console.log('hoi');
      });
      });
      }
    </script>

    <script src="transport/request_cli_ctx_xhr.js"/>
    
    <script src="transport/socket_cli_http.js"/>
    
    <script>
      var xhr_context = new request_cli_ctx_xhr();
      var rxhr = new xhr_context.request('http://localhost:8081/tt');

      rxhr.send('zayaz', function(reply){
      alert(JSON.stringify(reply));
      });      
    </script>
  </head>
  <body>
  </body>
</html>
